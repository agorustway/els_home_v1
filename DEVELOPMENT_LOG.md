# Development Log

## [2026-01-23] - S3(MinIO) 연결 성공 및 UI/UX 대규모 개선

### 🚀 핵심 성과
- **S3(MinIO) 연결 완전 정복**: ISP 포트 차단(9000번 대) 문제를 HTTPS 역방향 프록시(443)와 WebSocket 헤더 설정을 통해 해결.
- **관리자 권한 관리 모바일화**: 테이블 형태의 레이아웃을 카드 슬롯(Card View) 방식으로 전면 개편하여 모바일 조작 편의성 극대화.
- **UI/UX 폴리싱**: 전사 메인 레이아웃 패딩 최적화, 헤더 유격 수정, 푸터 사이즈 축소 등 프리미엄 디자인 완성.

### 🛠️ 작업 상세
#### 1. 인프라 및 API
- `.env.local`: `NAS_ENDPOINT`를 HTTPS 프록시 주소로 설정.
- `lib/s3.js`: S3 클라이언트 설정 최적화 및 `getFileBufferFromS3` 추가로 이미지 서빙 안정화.
- `app/api/s3/files/route.js`: POST(업로드), GET(프록시 다운로드) 로직 구현.

#### 2. 프론트엔드 개선
- `app/admin/users/page.js`: 모바일용 카드 뷰 추가 및 반응형 레이아웃 적용. (Intranet 공통 모듈 연동)
- `app/employees/webzine/page.js`: S3 이미지 로딩 버그 수정 및 썸네일 경로 로직 최적화.
- `webzine/[id]/page.js`: 상세보기에서 Cloud 이미지 경로 인식하도록 수정.

#### 3. 기타 수정
- 소위원회 및 회사소개 페이지 서브메뉴 유격(20px) 제거.
- 푸터 높이 및 여백 축소.

### ⚠️ 주의사항 및 향후 과제
- **시놀로지 설정 유지**: 역방향 프록시에서 `X-Forwarded-Proto` 헤더와 `192.168.0.4` 대상 세팅이 바뀌면 S3 업로드가 바로 막힐 수 있음.
- **Webzine 이미지**: 이제 `Webzine/`으로 시작하는 모든 경로는 S3 Proxy API를 거쳐야 함.

---

## [2026-01-23] - 오픈 준비: 사용자 활동 로그(Audit Log) 시스템 구축

### 🚀 핵심 성과
- **전사 로그 시스템 도입**: 모든 사용자의 행위(이동, 클릭, 다운로드)를 실시간으로 기록하여 보안 및 운영 도구 확보.
- **3년 보관 정책 수립**: 서비스 오픈 가이드에 따라 로그 데이터를 최소 3년 동안 보관하도록 설계.

### 🛠️ 작업 상세
#### 1. 데이터베이스 (`web/supabase_user_logs.sql`)
- `user_activity_logs` 테이블 생성: `user_id`, `action_type`, `path`, `metadata`, `created_at` 등 포함.
- **보안**: RLS 설정을 통해 일반 사용자는 자기 로그만 생성 가능하고, 조지는 오직 `Admin` 권한자만 가능하도록 격리.

#### 2. 로깅 모듈 (`utils/logger.js`, `utils/loggerServer.js`)
- 클라이언트와 서버 양측에서 로그를 남길 수 있는 통합 유틸리티 구현.

#### 3. 자동 추적 (`components/ActivityLogger.js`)
- `RootLayout`에 탑재되어 페이지 뷰(URL) 및 중요 클릭 이벤트를 비동기로 자동 기록.

#### 4. 파일 접근 로깅 (`api/nas/preview`, `api/s3/files`)
- NAS 및 S3 파일 다운로드/조회 시 서버 레벨에서 정확한 파일명과 함께 로그 생성.

#### 5. 성능 최적화 (S3 Proxy Speed Up)
- **비차단형 로깅**: 로그 기록이 파일 전송을 방해하지 않도록 Background 처리를 적용하여 Latency 최소화.
- **강력한 브라우저 캐싱**: `Cache-Control: immutable` 설정을 통해 중복 요청 시 서버를 거치지 않고 즉시 로딩되도록 개선.
- **Buffer 전송 최적화**: 대용량 파일도 안정적으로 전달하기 위해 서버 메모리 핸들링 보강.

### 📋 운영 가이드 (보관 및 삭제)
- **보관 기한**: 3년 (2026~2029)
- **삭제 방법**: Supabase SQL Editor를 통해 `INTERVAL '3 years'` 기준 삭제 쿼리 권장.

## [2026-01-23] - 게시판 UI/UX 고도화 및 개발 정책 수립

###  핵심 성과
- **인트라넷 디자인 통일성 확보**: 자유게시판, 업무보고, 웹진 등 모든 사내 게시판에 프리미엄 화이트 카드(detailCard) 레이아웃을 적용하여 가독성과 심미성을 극대화.
- **편집 환경(Editor) 대규모 개선**: 구식 폼 디자인을 걷어내고 현대적인 UI로 개편, Hero 배너 및 사이드바 통합 레이아웃 시스템 안착.
- **NEW 개발 정책 도입**: 모바일 체크 필수화, UI/UX 일관성 유지, 수정 부위 TDD 의무화 등 고품질 협업을 위한 가이드라인(AGENT_GUIDELINES.md) 업데이트.

###  작업 상세
#### 1. 게시판 UI/UX (Free Board, Reports, Webzine)
- oard.module.css: 프리미엄 에디터 및 상세 카드 스타일(editorCard, detailCard) 추가.
- intranet/board/free/page.js: 목록 페이지 레이아웃 통합 및 카드 디자인 적용.
- intranet/board/free/[id]/page.js & /edit/page.js: 상세 보기 및 수정 페이지 레이아웃 고도화.
- intranet/reports/page.js & eports/[id]/page.js: 업무보고 시스템의 통일된 레이아웃 및 스타일 적용.
- webzine/page.js: 목록 썸네일 폴백(Fallback) 로직 강화 및 경로 인식 버그 수정.
- webzine/[id]/page.js & detail.module.css: 상세 페이지를 화이트 카드 스타일로 전면 개편.

#### 2. 인프라 및 기타 로직
- pp/api/s3/files/route.js: multipart/form-data 처리 시 ormData 객체 초기화 누락 버그 수정.
- AGENT_GUIDELINES.md: 형이 요청한 신규 개발 정책(모바일 점검, UI/UX 유지, TDD) 공식 추가.

###  신규 추가 정책 (준수 사항)
1. **모바일 우선 점검**: 모든 수정 사항은 반드시 모바일 페이지 뷰에서의 레이아웃을 확인한다.
2. **톤앤매너 유지**: 기존 UI/UX의 정체성을 훼손하지 않고 조화롭게 기능을 추가/수정한다.
3. **TDD 의무화**: 수동 점검 및 테스트 스크립트를 통해 수정된 로직의 무결성을 반드시 검증한다.

---

## [2026-01-23] - 개발 정책 고도화: 환경별 UI '분리' 및 '구조화' 정책 수립

###  핵심 성과
- **환경별 UI/UX 최적화 정책 도입**: 데스크탑과 모바일의 톤앤매너를 각각 독립적으로 유지하며, 디바이스 환경에 최적화된 사용자 경험을 제공하는 
분리 개발 원칙 수립.
- **프로젝트 구조화(Structuralization) 의무화**: 모든 폴더와 파일의 체계적인 관리를 위해 정해진 디렉토리 규칙을 엄격히 준수하고 중복을 지양하는 구조화 정책 도입.
- **가이드라인 공식 업데이트**: .agent/AGENT_GUIDELINES.md에 해당 내용을 추가하여 향후 모든 개발의 근간으로 삼음.

###  상세 정책 내역
1. **데스크탑 vs 모바일 분리**: 단순 반응형을 넘어, 각 환경에 어울리는 독립된 디자인과 조작 방식을 적용한다. (상호 기능은 연결되되 UI는 해당 환경에 최적화)
2. **엄격한 구조화**: 파일 시스템을 직관적이고 체계적으로 관리하며, 특히 인트라넷 관련 기능은 (intranet) 그룹 내로 질서 있게 배치한다.

---
