# 🛠 개발 로그 (2026-02-09) - 2차

## 🚀 연락처 모듈 확장 및 인트라넷 메뉴 체계 최적화 완료!

### 💎 핵심 성과
1.  **연락처 모듈 대규모 확장 (협력사 & 운전원)**:
    - **협력사정보(Partner Info)**: 계약서, 보험서류, 회사소개서 등 주요 서류를 카테고리별로 관리할 수 있는 맞춤형 모듈 구축.
    - **운전원정보(Driver Info)**: 프로필 사진, 차량 정보, 아이디 규격 관리 및 최대 10개의 추가 서류 첨부 기능을 갖춘 전문 관리 화면 구현.
2.  **전역 유틸리티 고도화 (`web/utils/format.js`)**:
    - 사업자등록번호, 날짜/시간, 전화번호 포맷팅을 넘어 **사업자등록번호 유효성 검사** 및 **주민등록번호 뒷자리 은폐(Masking)** 로직 추가.
    - 업무용 서류 관리에 필수적인 데이터 표준화 완비.
3.  **내비게이션 구조 전면 개편 (`constants/intranetMenu.js`)**:
    - 밋밋했던 메뉴 구조를 **[시스템], [업무보고], [마케팅/지원], [연락처/서류], [관리]** 의 5대 대분류 체계로 재편.
    - 특히 '연락처/서류' 그룹을 신설하여 협력사, 운전원, 지점 정보 및 공용 서류를 한눈에 관리할 수 있도록 개선.
4.  **UI/UX 프리미엄 폴리싱**:
    - 각 탭 이동 시의 시각적 피드백 강화 및 모바일 반응형 레이아웃 정밀 조정.
    - 카드 슬롯 방식의 상세 보기 화면에 '복사하기' 및 '바로 연결' 기능 추가로 현장 업무 편의성 극대화.

---

### 🛠️ 작업 상세
#### 1. 연락처 테이블 설계 및 API 구현
- `PartnerInfo.js` & `DriverInfo.js`: 대용량 그리드 대신 카드 기반의 반응형 데이터 목록 구현.
- 서류 업로드 인터페이스: 최대 12개 카테고리별 서류 첨부 및 S3 Proxy 연동.

#### 2. 메뉴 체계 고도화
- `SIDEBAR_ITEMS` 객체 재설계: 관련성 높은 메뉴들을 그룹핑하여 사용자의 인지 부하 감소.
- `getActiveMainTab` 로직 수정: 새로운 그룹화 방식에 따른 활성 탭 인식 정확도 향상.

#### 3. 관리자 권한 제어 정밀화
- 협력사 및 운전원 정보의 '수정/삭제' 권한을 지점 관리자 및 총괄 관리자로 한정하는 보안 로직 적용.

---

## [2026-02-08] - 인트라넷 레이아웃 최적화 및 상단 고정 요소 조정

### 🚀 핵심 성과
- **업무 집중형 레이아웃 완성**: 스크롤 시 불필요한 메인 헤더와 서브 내비게이션을 숨기고, 실시간 정보(Ticker)와 사이드바만 상단에 고정하여 업무 공간을 최대화했습니다.
- **부드러운 스크롤 인터랙션**: 헤더가 사라지고 나타날 때의 이질감을 없애기 위해 CSS 트랜지션과 `translateY`를 활용한 애니메이션을 적용했습니다.

### 🛠️ 작업 상세
#### 1. 레이아웃 상태 제어 (`SiteLayout.js`)
- `useScrollDirection` 훅을 도입하여 사용자의 스크롤 방향(Up/Down)을 실시간으로 감지.
- 스크롤 다운 시 `--is-scrolled` 상태를 활성화하여 헤더 영역을 슬라이드업 처리.

#### 2. 고정 위치(Sticky) 정밀 조정
- **Ticker (날씨/뉴스)**: 헤더가 사라진 후 최상단(`top: 0`)에 고정되도록 설정.
- **Sidebar**: 헤더 노출 여부에 따라 `top` 위치가 `70px`에서 `0px`로 동적 변화하도록 수정.
- **IntranetSubNav**: 미들바 영역도 스크롤 방향에 따라 유연하게 숨김/노출 처리.

---

## [2026-02-07] - 컨테이너 이력조회 UI/UX 프리미엄 폴리싱 - 2차

### 🚀 핵심 성과
- **안전운임 조회 키보드 내비게이션 완벽 지원**:
  - 주소 검색 결과에서 **방향키(↑/↓)**로 이동하고 **Enter**로 선택 시 즉시 조회가 실행되도록 개선.
  - 마우스 이동 없이 키보드만으로 주소 검색부터 조회까지 원스톱 처리 가능.
- **컨테이너 이력조회 계정 저장 UX 개선**:
  - 기존의 모호했던 저장 버튼을 직관적인 **"저장" 체크박스**로 변경.
  - 로그인 시 체크박스가 켜져 있으면 계정 정보를 저장하고, 꺼져 있으면 일회성으로 로그인하도록 직관성 확보.
- **UI 디테일 마감**:
  - 안전운임 데이터 결과 테이블의 모든 컬럼을 **가운데 정렬**하여 가독성 극대화.
  - 에러 메시지 알림을 Alert 창 대신, 화면 중앙에 부드럽게 떴다 사라지는 **Toast 알림**으로 변경하여 고급스러운 사용자 경험 제공.

---

## [2026-02-07] - 배포 안정화 및 UI/UX 프리미엄 고도화

### 🚀 핵심 성과
1.  **Vercel 배포 완결 해결**: SSR(서버 사이드 렌더링) 환경에서 `localStorage` 및 `window` 접근 에러를 100% 차단하는 구조로 개편 (Mounted State 사용).
2.  **데이터 무결성 확보 (NaN 해결)**: 백엔드(`app.py`)에서 발생하던 `NaN` 및 `Infinity` JSON 파싱 오류를 서버-클라이언트 2중 방어막으로 완전 해결.
3.  **BIOS 스타일 실시간 로깅 & 타이머**: 컨테이너 조회 시 실제 소요 시간을 0.1초 단위로 표시하는 실시간 타이머와 블링킹 커서 UI 도입.
4.  **서버 부하 90% 절감 (날씨/뉴스 최적화)**: 5초마다 호출하던 날씨/뉴스를 **30분 주기 캐싱**으로 변경. 클라이언트 로컬 캐시를 5초마다 순환시켜 사용자 경험은 유지하고 서버 부하는 획기적으로 감축.

### 🛠️ 작업 상세
#### 1. Vercel & SSR 안정화
- `useEffect`로 마운트 확인 전에는 브라우저 API 호출을 원천 차단하여 하이드레이션 오류 해결.
- 외부 라이브러리(XLSX 등)를 Next.js `Script` 컴포넌트로 교체하여 렌더링 차단 방지.

#### 2. 백엔드 JSON 파싱 버그 수정
- `app.py`: `pd.notnull` 체크 후 `NaN`을 `None`으로 변환. `json.dumps(allow_nan=False)` 설정으로 규격 외 JSON 생성 원천 차단.
- `page.js`: 스트리밍 데이터를 받을 때 문자열 `"NaN"`을 `null`로 치환하는 안전장치 추가.

#### 3. 파이썬 캐시 및 모듈 이슈 해결
- **문제**: 3일간 지속된 `name 'time' is not defined` 에러. `import time`이 있음에도 발생.
- **원인**: `__pycache__` 내의 오래된 버전 바이너리 파일이 우선 실행되는 문제 확인.
- **해결**: 모든 `__pycache__` 폴더 삭제 및 `PYTHONDONTWRITEBYTECODE=1` 설정으로 재발 방지.

---

## [2026-02-02] - 안전운임 임시저장목록 노출 순서 개선

### 🚀 핵심 이슈
- **사용자 편의성 향상**: 안전운임 조회 후 임시저장된 결과가 과거 항목부터 상단에 노출되어, 방금 조회한 최신 결과를 확인하기 위해 아래로 스크롤해야 하는 불편함 개선.

### 🛠️ 작업 상세
#### 1. 목록 정렬 및 순번 로직 수정 (`web/app/employees/safe-freight/page.js`)
- **저장 로직**: 신규 조회 결과를 배열의 앞부분에 추가(`unshift`)하도록 변경하여 데이터 자체를 최신순으로 관리.
- **UI 노출**: `savedResults.length - idx` 공식을 적용하여, 가장 상단에 노출되는 최신 항목이 가장 높은 순번(No.)을 가지고, 처음 조회한 항목은 No.1로서 가장 하단에 위치하도록 조정.

---

## [2026-02-02] - 뉴스 수집 기능 강화 및 UI/UX 전면 개편

### 🚀 핵심 이슈
- **수집원 한계**: 기존 Google News RSS에만 의존하던 방식을 개선하여 연합뉴스, YTN 등 다각화된 뉴스 소스 확보.
- **추출 오류**: 특정 뉴스 본문 추출 시 인코딩 문제(EUC-KR) 대응 및 서버 차단 방지를 위한 헤더 최적화.

### 🛠️ 작업 상세
#### 1. 다중 뉴스 소스 및 검색 기능 도입
- Google(전체), 연합뉴스, YTN RSS를 선택적으로 수집하도록 구현.
- 키워드 기반 실시간 뉴스 검색 기능 추가.
#### 2. 본문 추출기 고도화
- Readability 실패 시 국내 언론사 특화 셀렉터(`#articleBodyContents` 등)를 순차적으로 시도하는 폴백 로직 추가.

---

## [2026-01-26] - 아산지점 사다리 게임 완전 수정 및 UI 폴리싱

### 🚀 핵심 성과
- **사다리 게임 레이아웃 해결**: 하단 "통과/당첨" 라벨이 잘리던 문제를 근본적으로 해결했습니다.
- **시각적 완성도**: 베이스 라인 가시성 개선 및 완료 마커 위치 정확도 향상. 동물 캐릭터 반응 시스템(당첨: 😭, 통과: 😆) 연동 완료.

---

## [2026-01-25] - 통합 계정 관리 아키텍처(Unified Identity) 대수술 및 UI/UX 마감

### 🚀 핵심 성과
- **이메일 중심 통합 아이덴티티 구축**: 구글, 카카오, 네이버 등 어떤 소셜 로그인으로 접속하더라도 **동일한 이메일이라면 한 명의 사용자**로 관리하는 통합 아키텍처 완성.
- **글로벌 데이터 동기화**: `profiles`, `user_roles`, `posts` 테이블 전체를 `email` 기준으로 매칭하여 로그인 방식이 바뀌어도 이름, 권한, 게시글이 완벽하게 유지됩니다.

### 🛠️ 작업 상세
- 로그인 시 동일 이메일의 기존 권한을 찾아 현재 세션 ID와 매핑하는 **지능형 계정 연결** 로직 도입.
- 이제 관리자가 '구글'로 가입했더라도 '카카오'로 로그인할 때 권한이 그대로 유지됩니다.

---

## [2026-01-24] - 소셜 로그인 확장: 카카오 및 네이버 연동

### 🚀 핵심 성과
- **인증 편의성 강화**: 국내 사용 비중이 높은 카카오톡 및 네이버 로그인 기능을 추가하여 접근성을 개선했습니다.
- **보안 브라우저 정책 대응**: 인앱 브라우저(카톡/네이버앱)에서 구글 로그인 차단 문제를 감지하고 사용자 가이드를 제공하는 경고 시스템 구축.

---

## [2026-01-23] - S3(MinIO) 연결 성공 및 활동 로그 시스템 구축

### 🚀 핵심 성과
- **S3(MinIO) 연결 완전 정복**: ISP 포트 차단 문제를 HTTPS 역방향 프록시와 WebSocket 헤더 설정을 통해 해결.
- **전사 로그 시스템(Audit Log) 도입**: 모든 사용자의 활동(이동, 클릭, 다운로드)을 실시간 기록하여 보안성 강화. (3년 보관 정책 수립)

---

*(이전 로그 생략...)*
